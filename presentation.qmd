---
title: "Meteoric Fall: a comet-ment to data"
subtitle: "INFO 523 - Fall 2024 - Project Final"
author: "Nick Ferrante, Jasdeep Singh Jhajj, Agastya Deshraju"
title-slide-attributes:
  data-background-image: images/airplane.png
  data-background-size: stretch
  data-background-opacity: "0.7"
  data-slide-number: none

theme:  [beige,data/customtheming.scss]
    transition: concave
    background-transition: fade

editor: visual
execute:
  echo: false
---

```{r setup, echo=FALSE}
#| label: setup
#| include: false

# Plot theme
ggplot2::theme_set(ggplot2::theme_minimal(base_size = 11))

# For better figure resolution
knitr::opts_chunk$set(
  fig.retina = 3,
  dpi = 300,
  #fig.width = 6, 
  fig.asp = 0.618 
  )
```


```{r load_pkgs, echo=FALSE}
#| label: load_pkgs
#| message: false
#| warning: false
#| code-summary: "Load Packages"

if (!require("pacman")) 
  install.packages("pacman")

pacman::p_load(tidyverse,
               dplyr,
               scales,
               arules,
               arulesViz,
               viridis,
               reshape2,
               cluster,
               dbscan,
               e1071,
               Rtsne) 
```


```{r}
data <- read.csv('train.csv')
data[is.na(data)] <- 0
data$satisfaction <- ifelse(data$satisfaction == "satisfied", "satisfied", "unsatisfied")
data$satisfaction_numerical <- ifelse(data$satisfaction == "satisfied", 1, 0)
numeric_data <- data[, -c(1,2,3,4,6,7,25)]

```


### Heatmap Correlation
```{r}
cor_matrix <- cor(numeric_data, use = "complete.obs")

cor_melted <- melt(cor_matrix)

ggplot(cor_melted, aes(x = Var1, y = Var2, fill = value)) +
  geom_tile(color = "white") +
  scale_fill_gradient(low = "#d6eaf8", high = "#4f86c1") + # Blue-to-Green gradient
  labs(
    title = "Correlation Matrix Heatmap",
    x = "Features",
    y = "Features",
    fill = "Correlation"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))

```
### Heatmap interpretation

* There's a strong correlation between *Seat Comfort, Inflight Entertainment, Online Boarding* with *Satisfaction*
* While operating metrics like *Delays* negatively affect customer satisfaction, their impact is relatively weaker compared to customer-facing metrics



```{r}
# Prepare the dataset
data_temp <- data

# Define the columns to be recoded
columnsSQE <- c("Online.boarding", "Seat.comfort", "Inflight.entertainment", 
                "Leg.room.service", "On.board.service", "Cleanliness", 
                "Inflight.wifi.service", "Baggage.handling")

# Recode numeric columns into factors: "Poor", "Neutral", "Good"
recode_to_factors <- function(column) {
  factor(ifelse(column %in% c(1, 2), "Poor",
         ifelse(column == 3, "Neutral", "Good")),
         levels = c("Poor", "Neutral", "Good"))
}

for(col in columnsSQE){
  data_temp[[col]] <- recode_to_factors(data_temp[[col]])
}

# Add a new column for satisfaction as a factor
data_temp$satisfaction <- factor(ifelse(data_temp$satisfaction_numerical == 1, 
                                        "Satisfied", "Unsatisfied"),
                                  levels = c("Unsatisfied", "Satisfied"))

# Include the satisfaction column in the subset for transactions
columnsSQE <- c(columnsSQE, "satisfaction")

# Subset only the selected columns for association rule mining
data_subset <- data_temp[, columnsSQE]

# Convert to transactions format
transactions <- as(data_subset, "transactions")
```


```{r}
# Plot item frequencies
itemFrequencyPlot(transactions, support = 0.3, cex.names = 0.8, col = "#4f86c1")
```

### Apriori
```{r}
# Run the Apriori algorithm
ars_adjusted <- apriori(transactions, parameter = list(support = 0.02, confidence = 0.6))

# Subset rules where satisfaction = Satisfied is in the rhs
satisfied_rules <- subset(ars_adjusted, rhs %in% "satisfaction=Satisfied")

# Extract top 10 rules by Lift
top_rules_lift <- sort(satisfied_rules, by = "lift")[1:10]
```


```{r}
plot(
  top_rules_lift,
  method = "graph",
  engine = "htmlwidget",
  control = list(
    nodeCol = "#4ebded",  # Node color (blue-green)
    edgeCol = "#4f86c1",  # Edge color (light blue)
    alpha = 0.8           # Transparency for edges
  )
)

```

* Positive features like *Seat comfort, Inflight entertainment, Online boarding, Leg room service* and *On-board service* are connected to multiple rules indicating that they play significant roles in driving satisfaction.
* Features such as *Baggage handling* and *Cleanliness* play important roles as well but not as much as the ones mentioned before. 
```{r}
plot(
  satisfied_rules,
  method = "scatterplot",
  measure = c("support", "confidence"),
  shading = "lift",
  control = list(
    col = colorRampPalette(c( "#4f86c1", "#d6eaf8"))(1.8)
  )
)
```



### FP Growth


```{r}
fp_itemsets <- apriori(transactions, parameter = list(support = 0.02, target = "frequent itemsets"))

# Generate rules from the frequent itemsets
fp_rules <- apriori(transactions, parameter = list(support = 0.02, confidence = 0.6))

# Filter rules where satisfaction = Satisfied is in the RHS
unsatisfaction_rules <- subset(fp_rules, rhs %in% "satisfaction=Unsatisfied")

```



```{r}
# Scatterplot for satisfaction rules
plot(
  unsatisfaction_rules, 
  method = "scatterplot", 
  measure = c("support", "confidence"), 
  shading = "lift",
  control = list(
    col = colorRampPalette(c( "#4f86c1", "#d6eaf8"))(1.8)
  )
)
```



```{r}
top_unsatisfaction_rules <- sort(unsatisfaction_rules, by = "lift")[1:10]
plot(
  top_unsatisfaction_rules, 
  method = "graph", 
  engine = "htmlwidget",
  control = list(
    nodeCol = "#4ebded",  # Node color (blue-green)
    edgeCol = "#4f86c1",  # Edge color (light blue)
    alpha = 0.8           # Transparency for edges
  )
)
```

